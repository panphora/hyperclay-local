<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hyperclay Local Server</title>
    <link rel="stylesheet" href="renderer.css">
</head>
<body>
    <div class="app">
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">üéØ</div>
                    <h1>Hyperclay Local</h1>
                </div>
                <div class="status-indicator">
                    <div class="status-dot" id="statusDot"></div>
                    <span class="status-text" id="statusText">Server Stopped</span>
                </div>
            </div>
        </header>

        <main class="main">
            <div class="content">
                <div class="section">
                    <h2>üìÅ Select Your Apps Folder</h2>
                    <p>Choose the folder containing your Hyperclay HTML apps.</p>
                    
                    <div class="folder-selection">
                        <div class="selected-folder" id="selectedFolder">
                            <div class="folder-icon">üìÇ</div>
                            <span class="folder-path">No folder selected</span>
                        </div>
                        <button class="btn btn-primary" id="selectFolderBtn">
                            üìÅ Select Folder
                        </button>
                    </div>
                </div>

                <div class="section">
                    <h2>üöÄ Server Control</h2>
                    <p>Start the local server to run your HTML apps.</p>
                    
                    <div class="server-controls">
                        <button class="btn btn-success" id="startServerBtn" disabled>
                            ‚ñ∂Ô∏è Start Server
                        </button>
                        <button class="btn btn-danger" id="stopServerBtn" disabled>
                            ‚èπÔ∏è Stop Server
                        </button>
                        <button class="btn btn-secondary" id="openBrowserBtn" disabled>
                            üåê Open in Browser
                        </button>
                    </div>

                    <div class="server-info" id="serverInfo" style="display: none;">
                        <div class="info-item">
                            <strong>Server URL:</strong>
                            <span class="server-url" id="serverUrl">http://localhost:4321</span>
                            <button class="btn-link" id="copyUrlBtn">Copy</button>
                        </div>
                        <div class="info-item">
                            <strong>Serving from:</strong>
                            <span class="folder-path-info" id="folderPathInfo"></span>
                            <button class="btn-link" id="openFolderBtn">Open Folder</button>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h2>üí° How to Use</h2>
                    <div class="instructions">
                        <div class="instruction-step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <strong>Select your folder</strong> containing HTML apps
                            </div>
                        </div>
                        <div class="instruction-step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <strong>Start the server</strong> to make your apps accessible
                            </div>
                        </div>
                        <div class="instruction-step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <strong>Visit localhost:4321</strong> in your browser to see your apps
                            </div>
                        </div>
                        <div class="instruction-step">
                            <div class="step-number">4</div>
                            <div class="step-content">
                                <strong>Edit and save</strong> your apps directly in the browser
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h2>üîó Quick Links</h2>
                    <div class="quick-links">
                        <a href="https://hyperclay.com/" class="link-card" id="hyperclayLink">
                            <div class="link-icon">üåê</div>
                            <div class="link-content">
                                <strong>Hyperclay.com</strong>
                                <span>Visit the online platform</span>
                            </div>
                        </a>
                        <a href="https://docs.hyperclay.com/" class="link-card" id="docsLink">
                            <div class="link-icon">üìö</div>
                            <div class="link-content">
                                <strong>Documentation</strong>
                                <span>Learn more about Hyperclay</span>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </main>

        <footer class="footer">
            <p>Made with ‚ù§Ô∏è for <strong>Hyperclay</strong> - The platform for malleable HTML applications</p>
        </footer>
    </div>

    <script>
        // Initialize the app
        let currentState = {
            selectedFolder: null,
            serverRunning: false,
            serverPort: 4321
        };

        // DOM elements
        const elements = {
            statusDot: document.getElementById('statusDot'),
            statusText: document.getElementById('statusText'),
            selectedFolder: document.getElementById('selectedFolder'),
            selectFolderBtn: document.getElementById('selectFolderBtn'),
            startServerBtn: document.getElementById('startServerBtn'),
            stopServerBtn: document.getElementById('stopServerBtn'),
            openBrowserBtn: document.getElementById('openBrowserBtn'),
            serverInfo: document.getElementById('serverInfo'),
            serverUrl: document.getElementById('serverUrl'),
            folderPathInfo: document.getElementById('folderPathInfo'),
            copyUrlBtn: document.getElementById('copyUrlBtn'),
            openFolderBtn: document.getElementById('openFolderBtn'),
            hyperclayLink: document.getElementById('hyperclayLink'),
            docsLink: document.getElementById('docsLink')
        };

        // Event listeners
        elements.selectFolderBtn.addEventListener('click', async () => {
            await window.electronAPI.selectFolder();
        });

        elements.startServerBtn.addEventListener('click', async () => {
            elements.startServerBtn.disabled = true;
            elements.startServerBtn.textContent = '‚è≥ Starting...';
            try {
                await window.electronAPI.startServer();
            } catch (error) {
                console.error('Failed to start server:', error);
                elements.startServerBtn.disabled = false;
                elements.startServerBtn.textContent = '‚ñ∂Ô∏è Start Server';
            }
        });

        elements.stopServerBtn.addEventListener('click', async () => {
            await window.electronAPI.stopServer();
        });

        elements.openBrowserBtn.addEventListener('click', async () => {
            await window.electronAPI.openBrowser();
        });

        elements.copyUrlBtn.addEventListener('click', async () => {
            try {
                await navigator.clipboard.writeText(elements.serverUrl.textContent);
                elements.copyUrlBtn.textContent = 'Copied!';
                setTimeout(() => {
                    elements.copyUrlBtn.textContent = 'Copy';
                }, 2000);
            } catch (error) {
                console.error('Failed to copy URL:', error);
            }
        });

        elements.openFolderBtn.addEventListener('click', async () => {
            await window.electronAPI.openFolder();
        });

        elements.hyperclayLink.addEventListener('click', (e) => {
            e.preventDefault();
            window.electronAPI.openBrowser('https://hyperclay.com');
        });

        elements.docsLink.addEventListener('click', (e) => {
            e.preventDefault();
            window.electronAPI.openBrowser('https://docs.hyperclay.com');
        });

        // Listen for state updates
        window.electronAPI.onStateUpdate((state) => {
            updateUI(state);
        });

        // Update UI based on current state
        function updateUI(state) {
            currentState = { ...currentState, ...state };

            // Update status indicator
            if (currentState.serverRunning) {
                elements.statusDot.className = 'status-dot running';
                elements.statusText.textContent = 'Server Running';
            } else {
                elements.statusDot.className = 'status-dot stopped';
                elements.statusText.textContent = 'Server Stopped';
            }

            // Update folder selection
            if (currentState.selectedFolder) {
                elements.selectedFolder.innerHTML = `
                    <div class="folder-icon">üìÇ</div>
                    <span class="folder-path">${currentState.selectedFolder}</span>
                `;
                elements.startServerBtn.disabled = false;
            } else {
                elements.selectedFolder.innerHTML = `
                    <div class="folder-icon">üìÇ</div>
                    <span class="folder-path">No folder selected</span>
                `;
                elements.startServerBtn.disabled = true;
            }

            // Update server controls
            elements.startServerBtn.disabled = currentState.serverRunning || !currentState.selectedFolder;
            elements.stopServerBtn.disabled = !currentState.serverRunning;
            elements.openBrowserBtn.disabled = !currentState.serverRunning;

            if (!currentState.serverRunning) {
                elements.startServerBtn.textContent = '‚ñ∂Ô∏è Start Server';
            }

            // Update server info
            if (currentState.serverRunning && currentState.selectedFolder) {
                elements.serverInfo.style.display = 'block';
                elements.serverUrl.textContent = `http://localhost:${currentState.serverPort}`;
                elements.folderPathInfo.textContent = currentState.selectedFolder;
            } else {
                elements.serverInfo.style.display = 'none';
            }
        }

        // Initialize app state
        async function initializeApp() {
            const state = await window.electronAPI.getState();
            updateUI(state);
        }

        // Start the app
        initializeApp();
    </script>
</body>
</html>